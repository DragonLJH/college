<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/index.css">
    <script src="./js/vue.js"></script>
</head>

<body>
    <div id="app" class="home-div">
        <div class="top">
            <div class="logo">
                logo
            </div>
            <div class="main">
                <div class="item">
                    <span class="icon home"></span>首页
                </div>
            </div>
            <div class="operate">
                <div class="search">
                    <input v-model="quanwenjiansuo" type="text" placeholder="跨对象搜索">
                    <span class="icon quanwenjiansuo"></span>
                </div>
                <div class="operate-main">
                    <div class="item icon" :class="item" v-for="(item, index) in operateIcons" :key="index"></div>
                </div>
            </div>
        </div>
        <div class="main">
            <div class="main-left">
                <div class="item" v-for="(item, index) in leftIcons" :key="index">
                    <div class="icon" :class="item"></div>
                </div>
            </div>
            <div class="main-right">
                <div class="item" :style='{width:"350px",height:"200px"}'>
                    <div>
                        <div class="title">
                            <div class="title-icon">
                                <span class="icon kuaijiefangwen"></span>
                            </div>
                            <div class="title-operate icon shezhi"></div>
                        </div>
                        <div class="main icons">
                            <div class="icons-item">
                                <div>
                                    <div class="icon qingjia"></div>
                                </div>
                                <div>请假</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="item" v-for="(item, index) in mainItems" :key="index" :style='toPx(item.style)'>
                    <component :is="item.is" :img-data="item.imgData" :progress="item.progress" :title="item.title" :title-icon="item.titleIcon" :msg-div="item.msgDiv" />
                </div>

            </div>
        </div>
    </div>
</body>
<script>
    var mixin = {
        methods: {
            toPx: function(obj) {
                const newObj = {
                    ...obj
                }
                Object.entries(newObj).forEach(([k, v]) => {
                    if (Object.prototype.toString.call(v) == '[object Number]') newObj[k] += "px"
                })
                return newObj
            }
        }
    }
    var mixinSetting = {
        methods: {
            mixinSetting: function(data) {
                console.log("mixinSetting", data)
            }
        }
    }
    Vue.component('kjfw-div', {
        props: {
            title: {
                type: String
            },
            titleIcon: {
                type: String
            },
        },
        mixins: [mixinSetting],
        data: function() {
            return {}
        },
        methods: {},
        mounted() {},
        template: `
                    <div>
                        <div class="title">
                            <div class="title-icon">
                                <span class="icon" :class="titleIcon"></span>{{title}}
                            </div>
                            <div class="title-operate icon shezhi" @click="mixinSetting('123')"></div>
                        </div>
                        <div class="main icons">
                            <div class="icons-item">
                                <div>
                                    <div class="icon qingjia"></div>
                                </div>
                                <div>请假</div>
                            </div>
                        </div>
                    </div>`

    })
    Vue.component('common-div', {
        props: {
            title: {
                type: String
            },
            titleIcon: {
                type: String
            },
            imgData: {
                type: Object
            },
            progress: {
                type: Object
            },
            msgDiv: {
                type: Array
            }
        },
        mixins: [mixinSetting],
        data: function() {
            return {
                commonMsgDiv: []
            }
        },
        methods: {
            iconClick(index) {
                let item = JSON.parse(JSON.stringify(this.commonMsgDiv[index]))
                if (!item.isGroup) return
                item.active = !item.active
                if (item.active) {
                    item.icon = item.AIcon
                } else {
                    item.icon = item.unAIcon
                }
                this.$set(this.commonMsgDiv, index, item)
            }
        },
        mounted() {
            this.commonMsgDiv = JSON.parse(JSON.stringify(this.msgDiv))
        },
        template: `<div>
                    <div class="title">
                        <div class="title-icon">
                            <span class="icon" :class="titleIcon"></span>{{title}}
                        </div>
                            <div class="title-operate icon shezhi" @click="mixinSetting('123')"></div>
                    </div>
                    <div class="main">
                        <div class="img-div" v-if="imgData.show">
                            <div class="img">
                            </div>
                            <div class="msg">
                                <div v-for="(item, index) in imgData?.data" :key="index">
                                    {{item}}
                                </div> 
                            </div>
                        </div>
                        <div class="progress" v-if="progress.show">
                            <div class="item">
                                <div :style="{width: progress.pace }"></div>
                                <span>{{progress.pace}}({{progress.name}})</span>
                            </div>
                            <div class="icon shezhi"></div>
                        </div>
                        <div class="icon-div" v-for="(item, index) in commonMsgDiv" :key="index" >
                            <div @click="iconClick(index)" class="icon " :class="item.icon" :data-num="item.msg.data.length?item.msg.data.length:''"></div>
                            <div class="msg">
                                <div class="msg-item">
                                    <div>{{item.msg.title}}</div>
                                    <div>{{item.msg.time}}</div>
                                </div>
                                <div v-show="item.isGroup && item.active" class="msg-item"  v-for="(val, index) in item.msg.data" :key="index">
                                    <div>{{val.text}}</div>
                                    <div>{{val.time}}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`
    })

    var vm = new Vue({
        el: "#app",
        mixins: [mixin],
        data() {
            return {
                quanwenjiansuo: "",
                operateIcons: [
                    "zaixianbangzhu", "shezhi", "lieshu", "huanfu", "suoping", "tuichu"
                ],
                leftIcons: [
                    "leibie", "kehuguanli", "huodong", "wenjianjia_zhankai", "fenlei", "chanyeleibie", "jichuguanli", "zhengcepipei"
                ],
                mainItems: [{
                    is: "common-div",
                    id: 0,
                    title: "个人信息",
                    titleIcon: "cuiban",
                    imgData: {
                        show: true,
                        img: "",
                        data: ["小菲，上午好！", "最近登录时间：2022年/08/08 13:03", "明天有暴雨，记得出门带伞噢！"]
                    },
                    progress: {
                        show: true,
                        pace: "40%",
                        name: "课时"
                    },
                    msgDiv: [{
                        icon: "huiyi",
                        msg: {
                            title: "《关于公司全面预算规划会议》",
                            time: "08/10 18:12",
                            data: []
                        }
                    }, {
                        icon: "yikatong",
                        msg: {
                            title: "一卡通余额:**************",
                            time: "08/10 18:12",
                            data: []
                        }
                    }, {
                        icon: "wangzhan",
                        msg: {
                            title: "个人网站:xxx.xxx.xxx",
                            time: "08/10 18:12",
                            data: []
                        }
                    }, ],
                    style: {
                        width: 350,
                        height: 200,
                    }
                }, {
                    is: "common-div",
                    id: 1,
                    title: "待办",
                    titleIcon: "daiban",
                    imgData: {
                        show: false,
                    },
                    progress: {
                        show: false,
                    },
                    style: {
                        width: 350,
                        height: 200,
                    },
                    msgDiv: [{
                        isGroup: false,
                        icon: "folderShare",
                        msg: {
                            title: "草稿",
                            time: "08/10 18:12",
                            data: []
                        }
                    }, {
                        isGroup: true,
                        icon: "olderOpen",
                        active: true,
                        unAIcon: "folderShare",
                        AIcon: "olderOpen",
                        msg: {
                            title: "被退回",
                            time: "08/10 18:12",
                            data: [{
                                text: "项目立项申请",
                                time: "08/10 18:12"
                            }, {
                                text: "报销申请",
                                time: "08/10 18:12"
                            }, {
                                text: "资产领用申请",
                                time: "08/10 18:12"
                            }]
                        }
                    }, {
                        isGroup: true,
                        icon: "folderShare",
                        active: false,
                        unAIcon: "folderShare",
                        AIcon: "olderOpen",
                        msg: {
                            title: "被退回",
                            time: "08/10 18:12",
                            data: [{
                                text: "项目立项申请",
                                time: "08/10 18:12"
                            }, {
                                text: "报销申请",
                                time: "08/10 18:12"
                            }, {
                                text: "资产领用申请",
                                time: "08/10 18:12"
                            }]
                        }
                    }, ],
                }, ]
            }
        },
    })
</script>

</html>