<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/index.css">
    <script src="./js/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.2/echarts.min.js"></script>
</head>

<body>
    <div id="app" class="home-div">
        <div class="top">
            <!-- <div class="logo">
                logo
            </div>
            <div class="main">
                <div class="item">
                    <span class="icon home"></span>首页
                </div>
            </div>
            <div class="operate">
                <div class="search">
                    <input v-model="quanwenjiansuo" type="text" placeholder="跨对象搜索">
                    <span class="icon quanwenjiansuo"></span>
                </div>
                <div class="operate-main">
                    <div class="item icon" @click="iconClick(item.clickStr)" :class="`${item.name} ${item.iconSize}`" v-for="(item, index) in operateIcons" :key="index"></div>
                </div>
            </div> -->
        </div>
        <div class="main">
            <div class="main-left">
                <!-- <div class="item" v-for="(item, index) in leftIcons" :key="index">
                    <div class="icon" :class="item"></div>
                </div> -->
            </div>
            <div class="main-right" ref="main">
                <div class="item" :style='{width:"550px",height:"400px"}'>

                    <div></div>
                    <div class="icon icon-m" :class="item" v-for="(item, index) in ['guanbi_jiaobiao g-rt','guangbiao-tuozhuai t-r','guangbiao-tuozhuai t-b','guangbiao-tuozhuai t-rb',]" :key="index">

                    </div>

                </div>
                <control-div v-for="(item, index) in styleList" :key="index" v-model='item.style'>
                    <div>123</div>
                </control-div>
                <!-- <div class="item" :style='{width:"550px",height:"300px"}'>
                    <echarts-div title="" title-icon="leibie" />
                </div> -->

                <!-- <div class="item" v-for="(item, index) in mainItems" :key="index" :style='toPx(item.style)'>
                    <template v-if="item.is == 'common-div'">
                        <common-div :img-data="item.imgData" :progress="item.progress" :title="item.title" :title-icon="item.titleIcon" :msg-div="item.msgDiv"></common-div>
                    </template>
                    <template v-if="item.is == 'kjfw-div'">
                        <kjfw-div :title="item.title" :title-icon="item.titleIcon" :main="item.main" ></kjfw-div>
                    </template>
                </div> -->
                <!-- <component :is="item.is" :img-data="item.imgData" :progress="item.progress" :title="item.title" :title-icon="item.titleIcon" :msg-div="item.msgDiv" /> -->
            </div>
        </div>
    </div>
</body>
<script src="./js/mixins.js"></script>
<script src="./js/common-div.js"></script>
<script src="./js/kjfw-div.js"></script>
<script src="./js/echarts-div.js"></script>
<script>
    Vue.component('control-div', {
        inject: ['parent'],
        mixins: [mixin],
        props: {
            styleObject: {
                type: Object
            }
        },
        model: {
            prop: "styleObject",
            event: "change"
        },
        data() {
            return {
                controlStyle: this.styleObject
            }
        },
        mounted() {},
        methods: {
            canvasMouseDown(e, direction) {
                // 获取 control-div 组件的坐标以及宽高
                const {
                    x: cX,
                    y: cY,
                    width: cW,
                    height: cH
                } = this.$refs.canvas.getBoundingClientRect()
                const move = (moveEvent) => {
                    // 解构赋值 给 moveX 和 moveY 分别赋值 clientX 和 clientY
                    // 移动后的坐标
                    const {
                        clientX: moveX,
                        clientY: moveY
                    } = moveEvent
                    // 根据拖拽的节点方向（direction）重新计算
                    if (direction) {
                        let mW = cW
                        let mH = cH
                        if (direction.indexOf("r") !== -1) mW += moveX - cX - mW + 20
                        if (direction.indexOf("b") !== -1) mH += moveY - cY - mH + 20
                        if (mW + 20 > this.parent.MW) mW = this.parent.MW
                        if (mH + 20 > this.parent.MH) mH = this.parent.MH
                        this.controlStyle = {
                            ...this.controlStyle,
                            width: mW,
                            height: mH,
                        }
                        return
                    }
                }
                const up = (e) => { // 鼠标松开结束事件的监听 
                    document.removeEventListener("mousemove", move);
                    document.removeEventListener("mouseup", up);
                    this.$emit("change", this.controlStyle)
                    console.log("up", this.controlStyle)
                };
                // 鼠标按下的时候分别监听鼠标移动事件和鼠标松开事件
                document.addEventListener("mousemove", move);
                document.addEventListener("mouseup", up);
            }

        },
        template: `
            <div class="item" :style='toPx(controlStyle)' ref="canvas">
                <slot></slot>
                <div class="icon icon-m guanbi_jiaobiao g-rt"></div>
                <div @mousedown.stop="canvasMouseDown($event, direction)" class="icon icon-m guangbiao-tuozhuai" :class="direction" v-for="(direction, index) in ['r','b','rb',]" :key="index"></div> 
            </div> 
        `
    })
    var vm = new Vue({
        el: "#app",
        mixins: [mixin],
        provide() {
            return {
                parent: this
            }
        },
        data() {
            return {
                MX: 0,
                MY: 0,
                MW: 0,
                MH: 0,
                iconClicks: {
                    "homeSetting": () => {
                        console.log("homeSetting")
                    },
                },
                homeSet: false,
                styleList: [{
                    id: 0,
                    style: {
                        width: 300,
                        height: 200,
                    }
                }, {
                    id: 1,
                    style: {
                        width: 350,
                        height: 200,
                    }
                }, {
                    id: 2,
                    style: {
                        width: 400,
                        height: 200,
                    }
                }, ],
                quanwenjiansuo: "",
                operateIcons: [{
                    name: "zaixianbangzhu",
                    iconSize: "icon-m",
                    clickStr: ""
                }, {
                    name: "shezhi",
                    iconSize: "icon-m",
                    clickStr: "homeSetting"
                }, {
                    name: "lieshu",
                    iconSize: "icon-m",
                    clickStr: ""
                }, {
                    name: "huanfu",
                    iconSize: "icon-m",
                    clickStr: ""
                }, {
                    name: "suoping",
                    iconSize: "icon-m",
                    clickStr: ""
                }, {
                    name: "tuichu",
                    iconSize: "icon-l",
                    clickStr: ""
                }],
                leftIcons: [
                    "leibie", "kehuguanli", "huodong", "wenjianjia_zhankai", "fenlei", "chanyeleibie", "jichuguanli", "zhengcepipei"
                ],
                mainItems: [{
                    is: "common-div",
                    id: 0,
                    title: "个人信息",
                    titleIcon: "cuiban",
                    imgData: {
                        show: true,
                        img: "",
                        data: ["小菲，上午好！", "最近登录时间：2022年/08/08 13:03", "明天有暴雨，记得出门带伞噢！"]
                    },
                    progress: {
                        show: true,
                        pace: "40%",
                        name: "课时"
                    },
                    msgDiv: [{
                        icon: "huiyi",
                        msg: {
                            title: "《关于公司全面预算规划会议》",
                            time: "08/10 18:12",
                            data: []
                        }
                    }, {
                        icon: "yikatong",
                        msg: {
                            title: "一卡通余额:**************",
                            time: "08/10 18:12",
                            data: []
                        }
                    }, {
                        icon: "wangzhan",
                        msg: {
                            title: "个人网站:xxx.xxx.xxx",
                            time: "08/10 18:12",
                            data: []
                        }
                    }, ],
                    style: {
                        width: 350,
                        height: 200,
                    }
                }, {
                    is: "common-div",
                    id: 1,
                    title: "待办",
                    titleIcon: "daiban",
                    imgData: {
                        show: false,
                    },
                    progress: {
                        show: false,
                    },
                    style: {
                        width: 350,
                        height: 200,
                    },
                    msgDiv: [{
                        isGroup: false,
                        icon: "folderShare",
                        msg: {
                            title: "草稿",
                            time: "08/10 18:12",
                            data: []
                        }
                    }, {
                        isGroup: true,
                        icon: "olderOpen",
                        active: true,
                        unAIcon: "folderShare",
                        AIcon: "olderOpen",
                        msg: {
                            title: "被退回",
                            time: "08/10 18:12",
                            data: [{
                                text: "项目立项申请",
                                time: "08/10 18:12"
                            }, {
                                text: "报销申请",
                                time: "08/10 18:12"
                            }, {
                                text: "资产领用申请",
                                time: "08/10 18:12"
                            }]
                        }
                    }, {
                        isGroup: true,
                        icon: "folderShare",
                        active: false,
                        unAIcon: "folderShare",
                        AIcon: "olderOpen",
                        msg: {
                            title: "被退回",
                            time: "08/10 18:12",
                            data: [{
                                text: "项目立项申请",
                                time: "08/10 18:12"
                            }, {
                                text: "报销申请",
                                time: "08/10 18:12"
                            }, {
                                text: "资产领用申请",
                                time: "08/10 18:12"
                            }]
                        }
                    }, ],
                }, {
                    is: "kjfw-div",
                    id: 2,
                    style: {
                        width: 350,
                        height: 200,
                    },
                    title: "待办",
                    titleIcon: "kuaijiefangwen",
                    main: [{
                        title: "待办",
                        titleIcon: "kuaijiefangwen",
                    }, {
                        title: "待办",
                        titleIcon: "kuaijiefangwen",
                    }, {
                        title: "待办",
                        titleIcon: "kuaijiefangwen",
                    }, {
                        title: "待办",
                        titleIcon: "kuaijiefangwen",
                    }, {
                        title: "待办",
                        titleIcon: "kuaijiefangwen",
                    }, {
                        title: "待办",
                        titleIcon: "kuaijiefangwen",
                    }, {
                        title: "待办",
                        titleIcon: "kuaijiefangwen",
                    }, {
                        title: "待办",
                        titleIcon: "kuaijiefangwen",
                    }, {
                        title: "待办",
                        titleIcon: "kuaijiefangwen",
                    }, ]
                }]
            }
        },

        methods: {
            iconClick(str) {
                console.log("iconClick", str)
                if (str == "") return
                this.iconClicks[str]()
            },
            getMainXY() {
                const {
                    x,
                    y,
                    width,
                    height
                } = this.$refs.main.getBoundingClientRect()
                this.MX = x
                this.MY = y
                this.MW = width
                this.MH = height
            }
        },
        mounted() {
            this.getMainXY()
        },
    })
</script>

</html>